stage('test-examples') {

    if (env.SGX == "1") {
        env.MODE = "sgx"
    }
    else {
        env.MODE = "direct"
    }

        if (["ubuntu20.04", "ubuntu22.04"].contains(env.base_os)) {
            try {
                timeout(time: (env.EDMM ? 60 : 30), unit: 'MINUTES') {
                    sh '''
                        cd CI-Examples/scikit-learn-intelex
                        sed -i "s/\\/home\\/user\\/.local\\/lib/\\/usr\\/local\\/lib/" sklearnex.manifest.template
                        sed -i "s/{{ env.HOME }}\\/.local\\/lib/\\/usr\\/local\\/lib/" sklearnex.manifest.template
                        python3 scripts/download_dataset.py
                        make ${MAKEOPTS} all
                        ./run_tests.sh 2>&1 | tee RESULT
                    '''
                }
            } catch (Exception e) { }
        }

}
